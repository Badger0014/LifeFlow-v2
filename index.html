<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Dashboard Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- 1. CORE & THEME VARIABLES --- */
        :root {
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            
            /* Light Theme */
            --color-bg-primary: #f4f7f9;
            --color-bg-secondary: #ffffff;
            --color-bg-tertiary: #eef2f5;
            --color-text-primary: #1a202c;
            --color-text-secondary: #5a677d;
            --color-border: #e2e8f0;
            --color-shadow: rgba(0, 0, 0, 0.05);

            /* Accents */
            --color-accent: #3498db;
            --color-accent-hover: #2980b9;
            --color-success: #2ecc71;
            --color-danger: #e74c3c;
            --color-warning: #f39c12;
            
            --nav-height-mobile: 70px;
            --sidebar-width-desktop: 240px;
        }

        body[data-theme="dark"] {
            /* Dark Theme */
            --color-bg-primary: #1a202c;
            --color-bg-secondary: #2d3748;
            --color-bg-tertiary: #4a5568;
            --color-text-primary: #f7fafc;
            --color-text-secondary: #a0aec0;
            --color-border: #4a5568;
            --color-shadow: rgba(0, 0, 0, 0.2);
        }

        /* --- 2. GLOBAL STYLES & RESETS --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--color-bg-primary);
            color: var(--color-text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            line-height: 1.6;
        }

        h1, h2, h3 {
            color: var(--color-text-primary);
            margin-bottom: 0.75em;
            line-height: 1.2;
        }
        h1 { font-size: 2em; }
        h2 { font-size: 1.5em; border-bottom: 2px solid var(--color-border); padding-bottom: 10px; }
        p { margin-bottom: 1em; color: var(--color-text-secondary); }

        /* --- 3. CORE LAYOUT (Responsive: Mobile -> Desktop) --- */
        .dashboard-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        main {
            flex-grow: 1;
            /* Pad for bottom nav on mobile */
            padding-bottom: var(--nav-height-mobile);
        }

        .content-area {
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }

        /* --- 4. HEADER --- */
        header {
            background-color: var(--color-bg-secondary);
            padding: 20px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header h1 {
            font-size: 1.5em;
            margin-bottom: 0;
            color: var(--color-accent);
        }
        header h1 i { margin-right: 10px; }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* Currency Selector */
        .currency-selector select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--color-border);
            background-color: var(--color-bg-primary);
            color: var(--color-text-primary);
            cursor: pointer;
            font-size: 0.9em;
        }

        /* Dark Mode Toggle */
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .theme-switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--color-bg-tertiary);
            transition: .4s;
            border-radius: 28px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            font-size: 12px;
            color: var(--color-warning);
            content: "\f185"; /* Sun icon */
        }
        input:checked + .slider { background-color: var(--color-accent); }
        input:checked + .slider:before {
            transform: translateX(22px);
            color: var(--color-bg-primary);
            content: "\f186"; /* Moon icon */
        }

        /* --- 5. NAVIGATION (Mobile Bottom Bar & Desktop Sidebar) --- */
        
        /* Shared Link Styles */
        .nav-link {
            text-decoration: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: color 0.3s ease, background-color 0.3s ease;
            display: flex;
            align-items: center;
            font-weight: 500;
        }
        .nav-link:hover { color: var(--color-accent); }
        .nav-link.active { color: var(--color-accent); font-weight: 700; }
        .nav-link i { width: 30px; text-align: center; font-size: 1.2em; }

        /* Mobile Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--color-bg-secondary);
            box-shadow: 0 -4px 15px var(--color-shadow);
            display: flex;
            justify-content: space-around;
            height: var(--nav-height-mobile);
            z-index: 1000;
        }
        .bottom-nav .nav-link {
            flex-direction: column;
            justify-content: center;
            padding: 8px 10px;
            font-size: 0.8em;
            gap: 4px;
        }
        .bottom-nav .nav-link.active { background-color: var(--color-bg-tertiary); border-radius: 8px; }
        .bottom-nav .nav-link span { display: block; }
        .bottom-nav .nav-link i { font-size: 1.4em; }

        /* Desktop Sidebar */
        .sidebar {
            display: none; /* Hidden on mobile by default */
        }
        
        /* --- 6. PAGE CONTENT & TABS --- */
        .tab-content {
            display: none;
            opacity: 0;
            transition: opacity 0.4s ease-out;
        }
        /* Animation: Fade in active tab */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tab-content.active {
            display: block;
            opacity: 1;
            animation: fadeIn 0.5s ease-out;
        }

        /* --- 7. WIDGETS & CARDS --- */
        .card {
            background-color: var(--color-bg-secondary);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px var(--color-shadow);
            margin-bottom: 25px;
            position: relative;
            border: 1px solid var(--color-border);
        }
        .clear-card-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 1.1em;
            transition: color 0.2s;
        }
        .clear-card-btn:hover { color: var(--color-danger); }

        /* --- 8. FORMS & INPUTS --- */
        input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 14px;
            margin-bottom: 12px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            background-color: var(--color-bg-primary);
            color: var(--color-text-primary);
            font-size: 1rem;
            font-family: var(--font-main);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 3px var(--color-accent-hover-transparent, rgba(52, 152, 219, 0.2));
        }
        textarea { resize: vertical; min-height: 100px; }

        button {
            padding: 14px 20px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: none;
            background-color: var(--color-accent);
            color: white;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            width: 100%;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        button:hover {
            background-color: var(--color-accent-hover);
        }
        button:active {
            transform: scale(0.98);
        }
        button.btn-danger { background-color: var(--color-danger); }
        button.btn-danger:hover { background-color: #c0392b; }

        /* --- 9. SPECIFIC TAB STYLES --- */
        
        /* == HOME == */
        .home-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .home-widget {
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .home-widget:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--color-shadow);
        }
        .home-widget h3 {
            font-size: 1.1em;
            color: var(--color-text-secondary);
            margin-bottom: 10px;
        }
        .home-widget-value {
            font-size: 2.2em;
            font-weight: 700;
        }
        #home-balance-display.positive-amount { color: var(--color-success); }
        #home-balance-display.negative-amount { color: var(--color-danger); }

        .home-summary-list {
            list-style: none;
            padding: 0;
        }
        .home-summary-list li {
            padding: 10px 0;
            border-bottom: 1px dashed var(--color-border);
            display: flex;
            justify-content: space-between;
        }
        .home-summary-list li:last-child { border-bottom: none; }
        .empty-state {
            text-align: center;
            padding: 20px;
            color: var(--color-text-secondary);
            font-style: italic;
        }
        
        /* == EXPENSES == */
        .balance-box {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 10px;
            background-color: var(--color-bg-primary);
        }
        .balance-box p { margin: 0; color: var(--color-text-secondary); }
        #balance-amount {
            font-size: 2.8em;
            font-weight: 700;
        }
        /* Animation: Flash balance on update */
        @keyframes flashGreen {
            0%, 100% { color: var(--color-success); }
            50% { color: var(--color-text-primary); }
        }
        @keyframes flashRed {
            0%, 100% { color: var(--color-danger); }
            50% { color: var(--color-text-primary); }
        }
        .flash-green { animation: flashGreen 0.7s ease-out; }
        .flash-red { animation: flashRed 0.7s ease-out; }

        .expense-inputs {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        .expense-inputs > div {
            padding: 20px;
            border-radius: 10px;
            border: 1px solid;
        }
        #income-box { background-color: rgba(46, 204, 113, 0.05); border-color: var(--color-success); }
        #expense-box { background-color: rgba(231, 76, 60, 0.05); border-color: var(--color-danger); }
        #income-box h3 { color: var(--color-success); }
        #expense-box h3 { color: var(--color-danger); }
        #income-box button { background-color: var(--color-success); }
        #income-box button:hover { background-color: #27ae60; }
        #expense-box button { background-color: var(--color-danger); }
        #expense-box button:hover { background-color: #c0392b; }

        /* == TASKS == */
        #task-progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--color-bg-tertiary);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        #task-progress {
            width: 0%;
            height: 100%;
            background-color: var(--color-success);
            border-radius: 5px;
            transition: width 0.4s ease;
        }
        #task-progress-text {
            font-size: 0.9em;
            color: var(--color-text-secondary);
            text-align: right;
            margin-bottom: 20px;
        }

        /* == LIST STYLES (Tasks, Transactions, Notes) == */
        .list-group {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }
        /* Animation: Slide in new items */
        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .list-group.item-added li:first-child {
            animation: slideInDown 0.4s ease-out;
        }

        .list-group li, .note-preview {
            padding: 15px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }
        .list-group li:hover {
            background-color: var(--color-bg-tertiary);
        }
        .list-group li:last-child { border-bottom: none; }
        
        .negative-amount { color: var(--color-danger); font-weight: 600; }
        .positive-amount { color: var(--color-success); font-weight: 600; }
        
        .list-actions { display: flex; align-items: center; gap: 10px; }
        .action-btn {
            background: none; border: none; cursor: pointer;
            font-size: 1.1em; padding: 5px; width: auto; margin-bottom: 0;
            color: var(--color-text-secondary);
            transition: color 0.2s, transform 0.2s;
        }
        .action-btn:hover { transform: scale(1.1); }
        .delete-btn:hover { color: var(--color-danger); }
        .complete-btn { font-size: 1.4em; }
        .complete-btn.completed { color: var(--color-success); }
        .complete-btn.pending { color: var(--color-text-secondary); }
        .complete-btn.pending:hover { color: var(--color-accent); }

        .todo-item.completed span {
            text-decoration: line-through;
            color: var(--color-text-secondary);
            font-style: italic;
        }

        /* == NOTES == */
        .note-preview {
            cursor: pointer;
            display: block;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .note-preview:hover {
            border-color: var(--color-accent);
            background-color: var(--color-bg-tertiary);
        }
        .note-preview h3 {
            margin: 0 0 5px 0;
            color: var(--color-accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .note-preview p {
            margin: 0;
            font-size: 0.9em;
            color: var(--color-text-secondary);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        .note-date {
            font-size: 0.8em;
            font-weight: 400;
            color: var(--color-text-secondary);
        }
        .note-delete-btn {
            background: none; border: none; color: var(--color-text-secondary);
            cursor: pointer; font-size: 1em; padding: 5px;
            transition: color 0.2s;
            z-index: 2; /* Be on top of the li click */
        }
        .note-delete-btn:hover { color: var(--color-danger); }
        
        /* --- 10. MODAL (for Notes) --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0; top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s ease;
        }
        .modal-content {
            background-color: var(--color-bg-secondary);
            margin: 10% auto;
            padding: 30px;
            border-radius: 12px;
            max-width: 90%;
            width: 600px;
            position: relative;
            animation: slideInDown 0.4s ease-out;
        }
        .modal-close {
            color: var(--color-text-secondary);
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-close:hover, .modal-close:focus {
            color: var(--color-text-primary);
        }
        #modal-note-title {
            margin-bottom: 10px;
            color: var(--color-accent);
        }
        #modal-note-date {
            font-size: 0.9em;
            color: var(--color-text-secondary);
            margin-bottom: 20px;
        }
        #modal-note-body {
            color: var(--color-text-primary);
            white-space: pre-wrap; /* Respects newlines in the note */
            max-height: 60vh;
            overflow-y: auto;
        }

        /* --- 11. DESKTOP RESPONSIVENESS --- */
        @media (min-width: 768px) {
            .dashboard-container {
                flex-direction: row;
            }
            main {
                flex-grow: 1;
                padding-bottom: 0; /* Remove mobile nav padding */
                margin-left: var(--sidebar-width-desktop);
                height: 100vh;
                overflow-y: auto; /* Allow main content to scroll */
            }
            .content-area {
                padding: 40px;
            }

            /* Hide mobile nav, show sidebar */
            .bottom-nav {
                display: none;
            }
            .sidebar {
                display: flex;
                flex-direction: column;
                width: var(--sidebar-width-desktop);
                height: 100vh;
                position: fixed;
                left: 0;
                top: 0;
                background-color: var(--color-bg-secondary);
                border-right: 1px solid var(--color-border);
                padding: 20px;
                z-index: 1000;
            }
            .sidebar-header {
                font-size: 1.8em;
                color: var(--color-accent);
                font-weight: 700;
                padding: 10px 15px 20px;
                text-align: left;
            }
            .sidebar-header i { margin-right: 10px; }

            .sidebar .nav-link {
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 5px;
                font-size: 1.1em;
            }
            .sidebar .nav-link i { margin-right: 15px; }
            .sidebar .nav-link:hover {
                background-color: var(--color-bg-tertiary);
            }
            .sidebar .nav-link.active {
                background-color: var(--color-accent);
                color: white;
            }

            /* Main Header (now inside main content) */
            header {
                background-color: transparent;
                border-bottom: none;
                padding: 0 0 20px 0;
            }
            header h1 { display: none; } /* Hide mobile header title */

            /* Layout Grids */
            .expense-inputs {
                grid-template-columns: 1fr 1fr;
            }
        }

    </style>
</head>
<body data-theme="light"> <div class="dashboard-container">
        
        <nav class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-rocket"></i> Manager
            </div>
            <a class="nav-link" data-tab="Home" onclick="showTab('Home')"><i class="fas fa-home"></i><span>Home</span></a>
            <a class="nav-link" data-tab="Expenses" onclick="showTab('Expenses')"><i class="fas fa-wallet"></i><span>Expenses</span></a>
            <a class="nav-link" data-tab="Tasks" onclick="showTab('Tasks')"><i class="fas fa-list-check"></i><span>Tasks</span></a>
            <a class="nav-link" data-tab="Notes" onclick="showTab('Notes')"><i class="fas fa-book"></i><span>Notes</span></a>
        </nav>

        <main>
            <header>
                <h1><i class="fas fa-rocket"></i> Life Manager</h1> <div class="header-controls">
                    <div class="currency-selector">
                        <select id="currency-select" onchange="updateCurrencySymbol()">
                            <option value="$">USD ($)</option>
                            <option value="£">GBP (£)</option>
                            <option value="€">EUR (€)</option>
                        </select>
                    </div>
                    <label class="theme-switch" for="theme-toggle">
                        <input type="checkbox" id="theme-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </header>

            <div class="content-area">

                <div id="Home" class="tab-content">
                    <h1>👋 Welcome Back!</h1>
                    <p>Here's a quick look at your current status.</p>
                    
                    <div class="home-grid">
                        <div class="card home-widget" onclick="showTab('Tasks')">
                            <h3><i class="fas fa-check-circle"></i> Tasks Left</h3>
                            <p id="home-task-count" class="home-widget-value">0</p>
                        </div>
                        <div class="card home-widget" onclick="showTab('Expenses')">
                            <h3><i class="fas fa-wallet"></i> Current Balance</h3>
                            <p id="home-balance-display" class="home-widget-value">£0.00</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2><i class="fas fa-clipboard-list"></i> Upcoming Tasks</h2>
                        <ul id="home-tasks-list" class="home-summary-list">
                            </ul>
                        <p id="home-tasks-empty" class="empty-state" style="display: none;">You're all caught up! 🎉</p>
                    </div>

                    <div class="card">
                        <h2><i class="fas fa-exchange-alt"></i> Recent Transactions</h2>
                        <ul id="home-transactions-list" class="home-summary-list">
                            </ul>
                         <p id="home-transactions-empty" class="empty-state" style="display: none;">No recent transactions.</p>
                    </div>

                    <div class="card">
                        <h2>💡 Quick Notes (Scratchpad)</h2>
                        <button class="clear-card-btn" onclick="clearScratchpad()" title="Clear Scratchpad">
                            <i class="fas fa-trash"></i>
                        </button>
                        <textarea id="quick-notes-text" rows="5" placeholder="Temporary scratchpad... text is saved instantly."></textarea>
                    </div>
                </div>

                <div id="Expenses" class="tab-content">
                    <div class="card">
                        <h2>💰 Financial Tracker</h2>
                        <div class="balance-box">
                            <p>Total Balance</p>
                            <div id="balance-amount" class="positive-amount">£0.00</div>
                        </div>

                        <div class="expense-inputs">
                            <div id="income-box">
                                <h3><i class="fas fa-plus-circle"></i> Add Income</h3>
                                <input type="text" id="income-desc" placeholder="Source (e.g., Paycheck)">
                                <input type="number" id="income-amount" placeholder="Amount">
                                <button onclick="addTransaction(true)">Log Income</button>
                            </div>
                            <div id="expense-box">
                                <h3><i class="fas fa-minus-circle"></i> Add Expense</h3>
                                <input type="text" id="expense-desc" placeholder="Item (e.g., Groceries)">
                                <input type="number" id="expense-amount" placeholder="Amount">
                                <button onclick="addTransaction(false)">Log Expense</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2>Transaction History (Last 14 Days)</h2>
                        <ul id="expense-list" class="list-group">
                            </ul>
                        <p id="expense-empty" class="empty-state" style="display: none;">No transactions in the last 14 days.</p>
                    </div>
                </div>

                <div id="Tasks" class="tab-content">
                    <div class="card">
                        <h2>📚 To-Do & Study Reminders</h2>
                        <input type="text" id="todo-input" placeholder="Add new task or study reminder...">
                        <button onclick="addTask()">Add Task</button>
                        
                        <div id="task-progress-bar">
                            <div id="task-progress"></div>
                        </div>
                        <p id="task-progress-text">0/0 tasks completed</p>

                        <ul id="todo-list" class="list-group">
                            </ul>
                        <p id="tasks-empty" class="empty-state" style="display: none;">No tasks yet. Add one above!</p>
                    </div>
                </div>

                <div id="Notes" class="tab-content">
                    <div class="card">
                        <h2>📝 New Note/Journal Entry</h2>
                        <input type="text" id="note-title" placeholder="Enter a Title for your Note">
                        <textarea id="note-body" rows="6" placeholder="Write your thoughts, ideas, or log..."></textarea>
                        <button onclick="addNote()">Save Note</button>
                    </div>

                    <div class="card">
                        <h2>Saved Notes</h2>
                        <ul id="notes-list">
                            </ul>
                        <p id="notes-empty" class="empty-state" style="display: none;">You haven't saved any notes yet.</p>
                    </div>
                </div>

            </div>
        </main>

        <nav class="bottom-nav">
            <a class="nav-link" data-tab="Home" onclick="showTab('Home')"><i class="fas fa-home"></i><span>Home</span></a>
            <a class="nav-link" data-tab="Expenses" onclick="showTab('Expenses')"><i class="fas fa-wallet"></i><span>Expenses</span></a>
            <a class="nav-link" data-tab="Tasks" onclick="showTab('Tasks')"><i class="fas fa-list-check"></i><span>Tasks</span></a>
            <a class="nav-link" data-tab="Notes" onclick="showTab('Notes')"><i class="fas fa-book"></i><span>Notes</span></a>
        </nav>
    </div>

    <div id="note-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeNoteModal()">&times;</span>
            <h2 id="modal-note-title">Note Title</h2>
            <p id="modal-note-date">Date</p>
            <div id="modal-note-body">Note content...</div>
        </div>
    </div>


    <script>
        // --- JAVASCRIPT LOGIC ---

        // ===================================
        // 0. GLOBAL STATE & UI ELEMENTS
        // ===================================
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let currentCurrency = localStorage.getItem('currencySymbol') || '£';
        const TWO_WEEKS_MS = 14 * 24 * 60 * 60 * 1000;

        // --- Element Cache ---
        const balanceAmountDisplay = document.getElementById('balance-amount');
        const homeBalanceDisplay = document.getElementById('home-balance-display');
        const homeTaskCount = document.getElementById('home-task-count');
        const expenseList = document.getElementById('expense-list');
        const todoList = document.getElementById('todo-list');
        const notesList = document.getElementById('notes-list');
        const quickNotesTextarea = document.getElementById('quick-notes-text');
        const noteTitleInput = document.getElementById('note-title');
        const noteBodyTextarea = document.getElementById('note-body');
        const todoInput = document.getElementById('todo-input');
        const noteModal = document.getElementById('note-modal');
        const themeToggle = document.getElementById('theme-toggle');

        // Empty States
        const tasksEmpty = document.getElementById('tasks-empty');
        const expenseEmpty = document.getElementById('expense-empty');
        const notesEmpty = document.getElementById('notes-empty');
        const homeTasksEmpty = document.getElementById('home-tasks-empty');
        const homeTransactionsEmpty = document.getElementById('home-transactions-empty');
        
        // Home Screen Lists
        const homeTasksList = document.getElementById('home-tasks-list');
        const homeTransactionsList = document.getElementById('home-transactions-list');

        // Task Progress
        const taskProgress = document.getElementById('task-progress');
        const taskProgressText = document.getElementById('task-progress-text');


        // ===================================
        // 1. CORE & UTILITY FUNCTIONS
        // ===================================
        function saveTransactions() { localStorage.setItem('transactions', JSON.stringify(transactions)); }
        function saveTasks() { localStorage.setItem('tasks', JSON.stringify(tasks)); }
        function saveNotes() { localStorage.setItem('notes', JSON.stringify(notes)); }

        // Helper to flash an element with a class
        function flashElement(element, className, duration = 700) {
            if (!element) return;
            element.classList.add(className);
            setTimeout(() => element.classList.remove(className), duration);
        }

        // Helper to animate list additions
        function animateListAdd(listElement) {
            listElement.classList.add('item-added');
            setTimeout(() => listElement.classList.remove('item-added'), 500);
        }

        // ===================================
        // 2. THEME (DARK MODE) LOGIC
        // ===================================
        function setAppTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeToggle.checked = (theme === 'dark');
        }

        themeToggle.addEventListener('change', () => {
            setAppTheme(themeToggle.checked ? 'dark' : 'light');
        });

        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme) {
                setAppTheme(savedTheme);
            } else {
                setAppTheme(systemPrefersDark ? 'dark' : 'light');
            }
        }

        // ===================================
        // 3. CURRENCY LOGIC
        // ===================================
        function updateCurrencySymbol() {
            const select = document.getElementById('currency-select');
            currentCurrency = select.value;
            localStorage.setItem('currencySymbol', currentCurrency);
            // Re-render all financial info
            renderTransactions();
            updateHomeScreen();
        }

        function formatCurrency(amount) {
            const sign = amount < 0 ? '-' : '';
            return `${sign}${currentCurrency}${Math.abs(amount).toFixed(2)}`;
        }

        // ===================================
        // 4. TAB NAVIGATION LOGIC
        // ===================================
        function showTab(tabId) {
            // Hide all content
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            // Deactivate all links
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            
            // Show active content
            document.getElementById(tabId).classList.add('active');
            
            // Activate current links (both mobile and desktop)
            document.querySelectorAll(`.nav-link[data-tab="${tabId}"]`).forEach(link => {
                link.classList.add('active');
            });
        }

        // ===================================
        // 5. HOME SCREEN LOGIC
        // ===================================
        function updateHomeScreen() {
            // --- 1. Task Count ---
            const incompleteTasks = tasks.filter(t => !t.completed);
            homeTaskCount.textContent = incompleteTasks.length;

            // --- 2. Balance ---
            // (This is handled by calculateBalance() which is called by renderTransactions())
            const totalBalance = transactions.reduce((acc, trans) => acc + trans.amount, 0);
            const formattedBalance = formatCurrency(totalBalance);
            homeBalanceDisplay.textContent = formattedBalance;
            homeBalanceDisplay.className = 'home-widget-value ' + (totalBalance >= 0 ? 'positive-amount' : 'negative-amount');
            
            // --- 3. Upcoming Tasks List ---
            homeTasksList.innerHTML = '';
            if (incompleteTasks.length === 0) {
                homeTasksEmpty.style.display = 'block';
                homeTasksList.style.display = 'none';
            } else {
                homeTasksEmpty.style.display = 'none';
                homeTasksList.style.display = 'block';
                incompleteTasks.slice(0, 3).forEach(task => { // Show top 3
                    const li = document.createElement('li');
                    li.textContent = task.text;
                    homeTasksList.appendChild(li);
                });
            }

            // --- 4. Recent Transactions List ---
            homeTransactionsList.innerHTML = '';
            const recentTransactions = transactions.slice().reverse().slice(0, 3); // Newest 3
            if (recentTransactions.length === 0) {
                homeTransactionsEmpty.style.display = 'block';
                homeTransactionsList.style.display = 'none';
            } else {
                homeTransactionsEmpty.style.display = 'none';
                homeTransactionsList.style.display = 'block';
                recentTransactions.forEach(trans => {
                    const li = document.createElement('li');
                    const amountClass = trans.amount < 0 ? 'negative-amount' : 'positive-amount';
                    li.innerHTML = `
                        <span>${trans.desc}</span>
                        <span class="${amountClass}">${formatCurrency(trans.amount)}</span>
                    `;
                    homeTransactionsList.appendChild(li);
                });
            }
        }

        // ===================================
        // 6. QUICK NOTES (Scratchpad) LOGIC
        // ===================================
        quickNotesTextarea.value = localStorage.getItem('quickNotesText') || '';
        quickNotesTextarea.addEventListener('input', () => {
            localStorage.setItem('quickNotesText', quickNotesTextarea.value);
        });
        
        function clearScratchpad() {
            if (confirm(`Are you sure you want to clear the Quick Notes scratchpad?`)) {
                localStorage.removeItem('quickNotesText');
                quickNotesTextarea.value = '';
            }
        }

        // ===================================
        // 7. MULTIPLE NOTES & MODAL LOGIC
        // ===================================
        function renderNotes() {
            notesList.innerHTML = '';
            if (notes.length === 0) {
                notesEmpty.style.display = 'block';
                notesList.style.display = 'none';
            } else {
                notesEmpty.style.display = 'none';
                notesList.style.display = 'block';
                notes.slice().reverse().forEach((note, index) => {
                    const originalIndex = notes.length - 1 - index;
                    const li = document.createElement('li');
                    li.className = 'note-preview';
                    
                    li.innerHTML = `
                        <div>
                            <h3>${note.title}</h3>
                            <p>${new Date(note.date).toLocaleDateString()} - ${note.body}</p>
                        </div>
                        <button class="note-delete-btn" onclick="deleteNote(event, ${originalIndex})">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    `;
                    
                    li.addEventListener('click', (e) => {
                        // Only open modal if the delete button wasn't clicked
                        if (!e.target.closest('.note-delete-btn')) {
                            openNoteModal(originalIndex);
                        }
                    });

                    notesList.appendChild(li);
                });
            }
        }

        function addNote() {
            const title = noteTitleInput.value.trim();
            const body = noteBodyTextarea.value.trim();

            if (title && body) {
                notes.push({ title, body, date: new Date().getTime() });
                saveNotes();
                renderNotes();
                noteTitleInput.value = '';
                noteBodyTextarea.value = '';
                animateListAdd(notesList);
            } else {
                alert('Both a Title and a Note Body are required.');
            }
        }

        function deleteNote(event, index) {
            event.stopPropagation(); // Stop the modal from opening
            if (confirm('Are you sure you want to delete this note permanently?')) {
                notes.splice(index, 1);
                saveNotes();
                renderNotes();
            }
        }

        function openNoteModal(index) {
            const note = notes[index];
            document.getElementById('modal-note-title').textContent = note.title;
            document.getElementById('modal-note-date').textContent = new Date(note.date).toLocaleString();
            document.getElementById('modal-note-body').textContent = note.body;
            noteModal.style.display = 'block';
        }

        function closeNoteModal() {
            noteModal.style.display = 'none';
        }
        // Close modal if clicking outside the content
        window.onclick = function(event) {
            if (event.target == noteModal) {
                closeNoteModal();
            }
        }

        // ===================================
        // 8. EXPENSE LOGIC (14-Day Filter)
        // ===================================
        function calculateBalance() {
            const totalBalance = transactions.reduce((acc, trans) => acc + trans.amount, 0);
            const formattedBalance = formatCurrency(totalBalance);
            
            // Update Expenses Tab Display
            balanceAmountDisplay.textContent = formattedBalance;
            balanceAmountDisplay.className = totalBalance >= 0 ? 'positive-amount' : 'negative-amount';
            
            // Update Home Widget (Handled by updateHomeScreen, but we ensure consistency)
            homeBalanceDisplay.textContent = formattedBalance;
            homeBalanceDisplay.className = 'home-widget-value ' + (totalBalance >= 0 ? 'positive-amount' : 'negative-amount');
        }

        function renderTransactions() {
            expenseList.innerHTML = '';
            const twoWeeksAgo = new Date().getTime() - TWO_WEEKS_MS;
            
            const recentTransactions = transactions.filter(trans => trans.date > twoWeeksAgo);

            if (recentTransactions.length === 0) {
                expenseEmpty.style.display = 'block';
                expenseList.style.display = 'none';
            } else {
                expenseEmpty.style.display = 'none';
                expenseList.style.display = 'block';
                
                recentTransactions.sort((a, b) => b.date - a.date).forEach(trans => {
                    const li = document.createElement('li');
                    const amountClass = trans.amount < 0 ? 'negative-amount' : 'positive-amount';
                    
                    // Find original index for deletion
                    const originalIndex = transactions.findIndex(t => t.date === trans.date && t.desc === trans.desc);

                    li.innerHTML = `
                        <span>
                            ${trans.desc} 
                            <span style="font-size:0.8em; color:var(--color-text-secondary); display: block;">
                                ${new Date(trans.date).toLocaleDateString()}
                            </span>
                        </span>
                        <div class="list-actions">
                            <span class="${amountClass}">${formatCurrency(trans.amount)}</span>
                            <button class="action-btn delete-btn" onclick="deleteTransaction(${originalIndex})">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    `;
                    expenseList.appendChild(li);
                });
            }
            calculateBalance();
        }

        function addTransaction(isIncome) {
            let desc, amountValue, amount;
            const date = new Date().getTime();

            if (isIncome) {
                desc = document.getElementById('income-desc').value.trim();
                amountValue = parseFloat(document.getElementById('income-amount').value);
                amount = Math.abs(amountValue);
            } else {
                desc = document.getElementById('expense-desc').value.trim();
                amountValue = parseFloat(document.getElementById('expense-amount').value);
                amount = -1 * Math.abs(amountValue);
            }

            if (desc && !isNaN(amountValue) && amountValue > 0) {
                transactions.push({ desc, amount, date });
                saveTransactions();
                renderTransactions();
                updateHomeScreen(); // Update home summary
                animateListAdd(expenseList); // Animate
                
                // Flash balance
                const flashClass = isIncome ? 'flash-green' : 'flash-red';
                flashElement(balanceAmountDisplay, flashClass);
                flashElement(homeBalanceDisplay, flashClass);

                // Clear inputs
                document.getElementById('income-desc').value = '';
                document.getElementById('income-amount').value = '';
                document.getElementById('expense-desc').value = '';
                document.getElementById('expense-amount').value = '';

            } else {
                alert('Please enter a valid description and a positive amount.');
            }
        }
        
        function deleteTransaction(index) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                transactions.splice(index, 1);
                saveTransactions();
                renderTransactions();
                updateHomeScreen();
            }
        }

        // ===================================
        // 9. TO-DO / REMINDER LOGIC
        // ===================================
        function renderTasks() {
            todoList.innerHTML = ''; 
            const completedTasks = tasks.filter(t => t.completed).length;
            const totalTasks = tasks.length;
            
            // Update Home Widget
            homeTaskCount.textContent = totalTasks - completedTasks;
            
            // Update Progress Bar
            const percentage = totalTasks === 0 ? 0 : (completedTasks / totalTasks) * 100;
            taskProgress.style.width = `${percentage}%`;
            taskProgressText.textContent = `${completedTasks} / ${totalTasks} tasks completed`;

            if (totalTasks === 0) {
                tasksEmpty.style.display = 'block';
                todoList.style.display = 'none';
            } else {
                tasksEmpty.style.display = 'none';
                todoList.style.display = 'block';
                
                // Sort to show incomplete tasks first
                tasks.sort((a, b) => a.completed - b.completed); 
                
                tasks.forEach((task, index) => {
                    const li = document.createElement('li');
                    li.className = task.completed ? 'todo-item completed' : 'todo-item';
                    
                    const completedClass = task.completed ? 'completed' : 'pending';
                    const icon = task.completed ? 'fa-check-square' : 'fa-regular fa-square';

                    li.innerHTML = `
                        <div class_name="task-content">
                            <button class="action-btn complete-btn ${completedClass}" onclick="toggleTask(${index})">
                                <i class="fas ${icon}"></i>
                            </button>
                            <span>${task.text}</span>
                        </div>
                        <button class="action-btn delete-btn" onclick="deleteTask(${index})">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    `;
                    todoList.appendChild(li);
                });
            }
            saveTasks();
        }

        function addTask() {
            const text = todoInput.value.trim();
            if (text) {
                tasks.push({ text: text, completed: false });
                renderTasks();
                updateHomeScreen(); // Update home summary
                animateListAdd(todoList);
                todoInput.value = '';
            }
        }

        function toggleTask(index) {
            tasks[index].completed = !tasks[index].completed;
            renderTasks();
            updateHomeScreen();
        }
        
        function deleteTask(index) {
            if (confirm('Are you sure you want to delete this task/reminder?')) {
                tasks.splice(index, 1);
                renderTasks();
                updateHomeScreen();
            }
        }

        // ===================================
        // 10. INITIAL PAGE SETUP
        // ===================================
        function initDashboard() {
            initTheme(); // Set dark/light mode
            
            // Set currency selector based on saved value
            document.getElementById('currency-select').value = currentCurrency;
            
            // Render all components
            renderTransactions();
            renderTasks();
            renderNotes();
            updateHomeScreen(); // Populate home screen summaries

            showTab('Home'); // Show the home tab by default
        }

        window.onload = initDashboard;
    </script>
</body>
</html>
