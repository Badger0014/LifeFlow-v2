<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Life Dashboard - V4 FINAL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- CORE CSS: Reset and Layout --- */
        body { font-family: 'Roboto', sans-serif; margin: 0; padding: 0; background-color: #f4f7f9; color: #333; }
        .dashboard-container { display: flex; flex-direction: column; min-height: 100vh; }
        
        /* --- HEADER & CURRENCY STYLES --- */
        header { background-color: #2c3e50; color: white; padding: 25px 20px 15px; text-align: center; position: relative; }
        header h1 { margin-bottom: 5px; }
        .currency-selector { position: absolute; top: 10px; right: 20px; }
        .currency-selector select { padding: 5px 10px; border-radius: 5px; border: none; background-color: #34495e; color: white; cursor: pointer; }
        
        /* --- NAVIGATION (Tabs at the bottom) --- */
        .nav-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #ffffff;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 1000;
        }
        .nav-link {
            text-decoration: none;
            color: #7f8c8d;
            padding: 8px 15px;
            cursor: pointer;
            transition: color 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.8em;
        }
        .nav-link.active, .nav-link:hover { color: #3498db; }
        
        /* --- PAGE CONTENT --- */
        .content-area { padding: 20px; flex-grow: 1; padding-bottom: 80px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* --- WIDGET STYLES --- */
        .card { 
            background-color: white; 
            padding: 25px; 
            border-radius: 10px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); 
            margin-bottom: 20px; 
            position: relative;
        }
        h2 { color: #2c3e50; font-size: 1.5em; margin-bottom: 15px; }
        
        /* --- FORM/INPUT STYLES --- */
        input[type="text"], input[type="number"], textarea, button { 
            padding: 12px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #dcdfe4; width: calc(100% - 24px); box-sizing: border-box; 
        }
        button { background-color: #3498db; color: white; cursor: pointer; border: none; transition: background-color 0.2s; font-weight: bold; }
        button:hover { background-color: #2980b9; }

        /* --- EXPENSE SPECIFIC STYLES --- */
        .balance-box { text-align: center; margin: 20px 0; padding: 15px; border-radius: 8px; background-color: #ecf0f1; }
        #balance-amount { font-size: 2.5em; font-weight: bold; }
        .expense-inputs { display: flex; gap: 10px; }
        .expense-inputs > div { flex: 1; padding: 15px; border-radius: 8px; }
        #income-box { background-color: #e6f7ee; border: 1px solid #2ecc71; }
        #expense-box { background-color: #fce7e7; border: 1px solid #e74c3c; }
        
        /* --- LIST STYLES (To-Do/Transactions) --- */
        .list-group { list-style: none; padding: 0; }
        .list-group li { 
            padding: 12px 0; border-bottom: 1px dotted #e0e6e9; display: flex; justify-content: space-between; align-items: center; 
        }
        .negative-amount { color: #e74c3c; font-weight: bold; }
        .positive-amount { color: #2ecc71; font-weight: bold; }
        .list-actions { display: flex; align-items: center; } 
        .delete-btn, .complete-btn { 
            background: none; border: none; cursor: pointer; font-size: 1em; margin-left: 10px; width: auto; 
        }
        .delete-btn { color: #e74c3c; }
        .complete-btn { color: #2ecc71; }
        .todo-item.completed span { text-decoration: line-through; color: #95a5a6; }

        /* --- NOTES SPECIFIC STYLES --- */
        #notes-list { list-style: none; padding: 0; margin-top: 20px; }
        .note-preview { padding: 15px; border: 1px solid #e0e6e9; border-radius: 6px; margin-bottom: 10px; cursor: pointer; position: relative; }
        .note-preview h3 { margin-top: 0; margin-bottom: 5px; color: #3498db; }
        .note-preview p { margin: 0; font-size: 0.9em; color: #7f8c8d; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .note-delete-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; color: #e74c3c; cursor: pointer; }
    </style>
</head>
<body>

    <div class="dashboard-container">
        
        <header>
            <h1>üöÄ Life Manager Dashboard</h1>
            <p>Your centralized hub for tracking goals, notes, and finances.</p>
            <div class="currency-selector">
                <select id="currency-select" onchange="updateCurrencySymbol()">
                    <option value="$">USD ($)</option>
                    <option value="¬£">GBP (¬£)</option>
                    <option value="‚Ç¨">EUR (‚Ç¨)</option>
                </select>
            </div>
        </header>

        <div class="content-area">

            <div id="Home" class="tab-content active">
                <h1>üëã Welcome Back!</h1>
                <p>A quick look at your current status.</p>
                <div class="home-grid">
                    <div class="card home-widget" onclick="showTab('Tasks', document.querySelector('.nav-link:nth-child(3)'))">
                        <h3><i class="fas fa-check-circle"></i> Tasks Left</h3>
                        <p id="home-task-count" style="font-size: 2em; font-weight: bold;">0</p>
                    </div>
                    <div class="card home-widget" onclick="showTab('Expenses', document.querySelector('.nav-link:nth-child(2)'))">
                        <h3><i class="fas fa-wallet"></i> Current Balance</h3>
                        <p id="home-balance-display" style="font-size: 2em; font-weight: bold;">¬£0.00</p>
                    </div>
                </div>
                
                <div class="card" style="margin-top: 20px;">
                    <h2>üí° Quick Notes (Scratchpad)</h2>
                    <button class="clear-card-btn" onclick="clearScratchpad()"><i class="fas fa-trash"></i></button>
                    <textarea id="quick-notes-text" rows="5" placeholder="Temporary scratchpad..."></textarea>
                    <p style="font-size: 0.8em; color: #7f8c8d;">*Text is saved instantly to this note.*</p>
                </div>
            </div>

            <div id="Expenses" class="tab-content">
                <div class="card">
                    <h2>üí∞ Financial Tracker</h2>
                    <div class="balance-box">
                        <p>Total Balance</p>
                        <div id="balance-amount" class="positive-amount">¬£0.00</div>
                    </div>

                    <div class="expense-inputs">
                        <div id="income-box">
                            <h3><i class="fas fa-plus-circle"></i> Add Income</h3>
                            <input type="text" id="income-desc" placeholder="Source (e.g., Paycheck, Gift)">
                            <input type="number" id="income-amount" placeholder="Amount">
                            <button onclick="addTransaction(true)">Log Income</button>
                        </div>
                        <div id="expense-box">
                            <h3><i class="fas fa-minus-circle"></i> Add Expense</h3>
                            <input type="text" id="expense-desc" placeholder="Item (e.g., Groceries, Rent)">
                            <input type="number" id="expense-amount" placeholder="Amount">
                            <button onclick="addTransaction(false)">Log Expense</button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2>Transaction History (Last 14 Days)</h2>
                    <ul id="expense-list" class="list-group">
                        </ul>
                </div>
            </div>

            <div id="Tasks" class="tab-content">
                <div class="card">
                    <h2>üìö To-Do & Study Reminders</h2>
                    <input type="text" id="todo-input" placeholder="Add new task or study reminder...">
                    <button onclick="addTask()">Add Task</button>
                    <ul id="todo-list" class="list-group">
                        </ul>
                </div>
            </div>

            <div id="Notes" class="tab-content">
                <div class="card">
                    <h2>üìù New Note/Journal Entry</h2>
                    <input type="text" id="note-title" placeholder="Enter a Title for your Note">
                    <textarea id="note-body" rows="8" placeholder="Write your thoughts, ideas, or log..."></textarea>
                    <button onclick="addNote()">Save Note</button>
                </div>

                <div class="card">
                    <h2>Saved Notes</h2>
                    <ul id="notes-list">
                        </ul>
                </div>
            </div>

        </div>

        <div class="nav-bar">
            <a class="nav-link active" onclick="showTab('Home', this)"><i class="fas fa-home"></i>Home</a>
            <a class="nav-link" onclick="showTab('Expenses', this)"><i class="fas fa-wallet"></i>Expenses</a>
            <a class="nav-link" onclick="showTab('Tasks', this)"><i class="fas fa-list-check"></i>Tasks</a>
            <a class="nav-link" onclick="showTab('Notes', this)"><i class="fas fa-book"></i>Notes</a>
        </div>
    </div>

    <script>
        // --- JAVASCRIPT LOGIC ---

        // ===================================
        // 0. GLOBAL STATE & UTILITIES
        // ===================================
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let currentCurrency = localStorage.getItem('currencySymbol') || '¬£'; // Default to GBP
        const TWO_WEEKS_MS = 14 * 24 * 60 * 60 * 1000;

        function saveTransactions() { localStorage.setItem('transactions', JSON.stringify(transactions)); }
        function saveTasks() { localStorage.setItem('tasks', JSON.stringify(tasks)); }
        function saveNotes() { localStorage.setItem('notes', JSON.stringify(notes)); }

        // ===================================
        // 1. CURRENCY LOGIC
        // ===================================
        function updateCurrencySymbol() {
            const select = document.getElementById('currency-select');
            currentCurrency = select.value;
            localStorage.setItem('currencySymbol', currentCurrency);
            renderTransactions();
        }

        function formatCurrency(amount) {
            return `${currentCurrency}${Math.abs(amount).toFixed(2)}`;
        }

        // ===================================
        // 2. TAB NAVIGATION LOGIC
        // ===================================
        function showTab(tabId, clickedElement) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');

            if (clickedElement) {
                clickedElement.classList.add('active');
            } else {
                document.querySelector('.nav-link').classList.add('active'); // Activate Home on load
            }
        }


        // ===================================
        // 3. QUICK NOTES (Scratchpad) LOGIC
        // ===================================
        const quickNotesTextarea = document.getElementById('quick-notes-text');
        
        // Load text on page load
        quickNotesTextarea.value = localStorage.getItem('quickNotesText') || '';

        // Autosave
        quickNotesTextarea.addEventListener('input', () => localStorage.setItem('quickNotesText', quickNotesTextarea.value));
        
        // Clear function
        function clearScratchpad() {
            if (confirm(`Are you sure you want to clear the Quick Notes scratchpad?`)) {
                localStorage.removeItem('quickNotesText');
                quickNotesTextarea.value = '';
            }
        }


        // ===================================
        // 4. MULTIPLE NOTES LOGIC (New)
        // ===================================
        const notesList = document.getElementById('notes-list');
        const noteTitleInput = document.getElementById('note-title');
        const noteBodyTextarea = document.getElementById('note-body');

        function renderNotes() {
            notesList.innerHTML = '';
            notes.slice().reverse().forEach((note, index) => { // Reverse to show latest first
                const li = document.createElement('li');
                li.className = 'note-preview';
                
                // Since we reverse, we need to map the rendered index back to the array index
                const originalIndex = notes.length - 1 - index; 

                li.innerHTML = `
                    <h3>${note.title}</h3>
                    <p>
                        <i class="fas fa-calendar-alt"></i> ${new Date(note.date).toLocaleDateString()} - ${note.body}
                    </p>
                    <button class="note-delete-btn" onclick="deleteNote(${originalIndex})"><i class="fas fa-trash-alt"></i></button>
                `;
                li.onclick = (e) => {
                    // Prevent clicking the list item from firing if the trash icon was clicked
                    if (!e.target.closest('.note-delete-btn')) {
                        // Populate inputs for editing (optional, simple copy here)
                        noteTitleInput.value = note.title;
                        noteBodyTextarea.value = note.body;
                        alert('Note copied to editor. Click "Save Note" to update or save as new.');
                    }
                };

                notesList.appendChild(li);
            });
        }

        function addNote() {
            const title = noteTitleInput.value.trim();
            const body = noteBodyTextarea.value.trim();

            if (title && body) {
                notes.push({ title, body, date: new Date().getTime() }); // Save timestamp
                saveNotes();
                renderNotes();
                noteTitleInput.value = '';
                noteBodyTextarea.value = '';
            } else {
                alert('Both a Title and a Note Body are required.');
            }
        }

        function deleteNote(index) {
            if (confirm('Are you sure you want to delete this note permanently?')) {
                notes.splice(index, 1);
                saveNotes();
                renderNotes();
            }
        }


        // ===================================
        // 5. EXPENSE LOGIC (14-Day Filter)
        // ===================================
        const balanceAmountDisplay = document.getElementById('balance-amount');
        const homeBalanceDisplay = document.getElementById('home-balance-display');
        const expenseList = document.getElementById('expense-list');


        function calculateBalance() {
            // Filter transactions to the last 14 days
            const twoWeeksAgo = new Date().getTime() - TWO_WEEKS_MS;
            const recentTransactions = transactions.filter(trans => trans.date > twoWeeksAgo);

            const balance = recentTransactions.reduce((acc, trans) => acc + trans.amount, 0);
            const totalBalance = transactions.reduce((acc, trans) => acc + trans.amount, 0); // Full balance for home display

            const formattedBalance = formatCurrency(totalBalance);
            const signSymbol = totalBalance >= 0 ? '' : '-';

            // Update Total Balance Display
            balanceAmountDisplay.textContent = signSymbol + formattedBalance;
            balanceAmountDisplay.className = totalBalance >= 0 ? 'positive-amount' : 'negative-amount';
            
            // Update Home Widget
            homeBalanceDisplay.textContent = signSymbol + formattedBalance;
            homeBalanceDisplay.style.color = totalBalance >= 0 ? '#2ecc71' : '#e74c3c';
        }

        function renderTransactions() {
            expenseList.innerHTML = '';
            const twoWeeksAgo = new Date().getTime() - TWO_WEEKS_MS;
            
            // 1. Filter transactions to include only those within the last 14 days
            const recentTransactions = transactions.filter(trans => trans.date > twoWeeksAgo);

            // 2. Sort by newest first and show the last 10 (most recent within the 14 days)
            recentTransactions.sort((a, b) => b.date - a.date).slice(0, 10).forEach(trans => {
                const li = document.createElement('li');
                const amountClass = trans.amount < 0 ? 'negative-amount' : 'positive-amount';
                
                // Find original index for deletion (this is complex but necessary when filtering)
                const originalIndex = transactions.findIndex(t => t.date === trans.date && t.desc === trans.desc && t.amount === trans.amount);


                li.innerHTML = `
                    <span>
                        ${trans.desc} 
                        <span style="font-size:0.8em; color:#95a5a6;">(${new Date(trans.date).toLocaleDateString()})</span>
                    </span>
                    <div class="list-actions">
                        <span class="${amountClass}">${formatCurrency(trans.amount)}</span>
                        <button class="delete-btn" onclick="deleteTransaction(${originalIndex})"><i class="fas fa-trash-alt"></i></button>
                    </div>
                `;
                expenseList.appendChild(li);
            });
            calculateBalance();
        }

        function addTransaction(isIncome) {
            // Existing addTransaction logic, but saving a timestamp now
            let desc, amountValue, amount;
            const date = new Date().getTime(); // Capture timestamp

            if (isIncome) {
                desc = document.getElementById('income-desc').value.trim();
                amountValue = parseFloat(document.getElementById('income-amount').value);
                amount = Math.abs(amountValue);
            } else {
                desc = document.getElementById('expense-desc').value.trim();
                amountValue = parseFloat(document.getElementById('expense-amount').value);
                amount = -1 * Math.abs(amountValue);
            }

            if (desc && !isNaN(amountValue) && amountValue > 0) {
                transactions.push({ desc, amount, date });
                saveTransactions();
                renderTransactions();
                
                // Clear inputs
                document.getElementById('income-desc').value = '';
                document.getElementById('income-amount').value = '';
                document.getElementById('expense-desc').value = '';
                document.getElementById('expense-amount').value = '';

            } else {
                alert('Please enter a valid description and a positive amount.');
            }
        }
        
        function deleteTransaction(index) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                transactions.splice(index, 1);
                saveTransactions();
                renderTransactions();
            }
        }


        // ===================================
        // 6. TO-DO / REMINDER LOGIC
        // ===================================
        const todoInput = document.getElementById('todo-input');
        const todoList = document.getElementById('todo-list');
        const homeTaskCount = document.getElementById('home-task-count');

        function renderTasks() {
            todoList.innerHTML = ''; 
            const incompleteTasks = tasks.filter(t => !t.completed).length;
            homeTaskCount.textContent = incompleteTasks;
            
            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = task.completed ? 'todo-item completed' : 'todo-item';
                
                const contentDiv = document.createElement('div');
                contentDiv.style.display = 'flex';
                contentDiv.style.alignItems = 'center';

                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'complete-btn';
                toggleBtn.innerHTML = task.completed ? '<i class="fas fa-check-square"></i>' : '<i class="far fa-square"></i>';
                toggleBtn.onclick = () => toggleTask(index);

                const span = document.createElement('span');
                span.textContent = task.text;

                contentDiv.appendChild(toggleBtn);
                contentDiv.appendChild(span);
                li.appendChild(contentDiv);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
                deleteBtn.onclick = () => deleteTask(index);
                li.appendChild(deleteBtn);

                todoList.appendChild(li);
            });
            saveTasks();
        }

        function addTask() {
            const text = todoInput.value.trim();
            if (text) {
                tasks.push({ text: text, completed: false });
                renderTasks();
                todoInput.value = '';
            }
        }

        function toggleTask(index) {
            tasks[index].completed = !tasks[index].completed;
            tasks.sort((a, b) => a.completed - b.completed); 
            renderTasks();
        }
        
        function deleteTask(index) {
            if (confirm('Are you sure you want to delete this task/reminder?')) {
                tasks.splice(index, 1);
                renderTasks();
            }
        }

        // ===================================
        // 7. INITIAL PAGE SETUP
        // ===================================
        function initDashboard() {
            // Set currency selector based on saved value
            document.getElementById('currency-select').value = currentCurrency;
            
            showTab('Home'); 
            renderTransactions();
            renderTasks();
            renderNotes();
        }

        window.onload = initDashboard;
    </script>
</body>
</html>
